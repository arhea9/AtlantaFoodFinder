<!DOCTYPE html>

<html>

  <head>
    {% load static %}

    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />

    <!-- Please DO NOT remove this line, all link and script tags will be merged to here -->

    <link rel="stylesheet" type="text/css" href="/css/common.css" />

    <link rel="stylesheet" type="text/css" href="/css/fonts.css" />


    <link rel="stylesheet" type="text/css" href="{% static 'restaurants/profile.css' %}" />
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5MEhM_JZWoMAyUrWAbDSX8ATypigqRHI&libraries=places&callback=initMap" async defer></script>

  </head>

  <body>
    <div class="profile-container">
        <!-- Profile Header Section -->
        <header class="profile-header">
            <h1>My Favorite Restaurants</h1>
            <p>Here are the restaurants you've marked as favorite:</p>
        </header>

        <!-- Favorites Section -->
        <section class="favorites-section">
            <div id="favorites-list" class="favorites-list">
                <!-- Favorite Restaurants will be injected here by JavaScript -->
            </div>
        </section>
    </div>

    <script>
        // Assuming you already have the favorites array from localStorage
        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];

        // The 'service' object can be used to retrieve restaurant details
        let service = new google.maps.places.PlacesService(document.createElement('div'));

        // Function to get restaurant details based on the place ID
        function getRestaurantDetails(placeId, callback) {
            service.getDetails({ placeId: placeId }, (placeDetails, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    callback(placeDetails);
                } else {
                    console.error('Failed to retrieve details for place ID:', placeId);
                }
            });
        }

        // Function to display favorite restaurants
        function displayFavoriteRestaurants() {
            const favoritesList = document.getElementById('favorites-list');
            favoritesList.innerHTML = ''; // Clear existing favorites list

            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p>No favorite restaurants added yet.</p>';
                return;
            }

            favorites.forEach(placeId => {
                getRestaurantDetails(placeId, placeDetails => {
                    const restaurantItem = document.createElement('div');
                    restaurantItem.className = 'restaurant-item';

                    // Dynamically build the restaurant details
                    restaurantItem.innerHTML = `
                        <div class="restaurant-info">
                            <h3>${placeDetails.name}</h3>
                            <p><strong>Address:</strong> ${placeDetails.formatted_address || 'Not available'}</p>
                            <p><strong>Rating:</strong> ${placeDetails.rating || 'Not available'}</p>
                            <button class="view-more-btn" onclick="window.open('https://www.google.com/maps/place/?q=place_id:${placeDetails.place_id}', '_blank')">View More</button>
                        </div>
                    `;

                    favoritesList.appendChild(restaurantItem);
                });
            });
        }

        // Call the function to display favorite restaurants when the page loads
        window.onload = displayFavoriteRestaurants;
    </script>
</body>

</html>
