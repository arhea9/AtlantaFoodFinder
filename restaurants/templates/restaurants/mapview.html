<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="stylesheet" type="text/css" href="{% static 'restaurants/mapview.css' %}" />
    <!-- Google Maps API with Places Library -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5MEhM_JZWoMAyUrWAbDSX8ATypigqRHI&libraries=places&callback=initMap" async defer></script>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="{% static 'restaurants/images/logo.png' %}" alt="Atlanta Food Finder" class="logo">
        </div>
    </header>

    <div class="container">
        <div class="sidebar">
            <div class="search-bar">
                <input type="text" id="search" placeholder="Search for a restaurant">
                <button id="filter-btn">
                    <img src="{% static 'restaurants/images/filter-icon.png' %}" alt="Filter">
                </button>
            </div>
            <h3>Top Results</h3>
            <div class="restaurant-list" id="restaurant-list">
                <!-- Dynamic list of restaurants will be inserted here -->
            </div>
            <div class="profile-container">
            <a href="{% url 'profile_page' %}">
                <img src="{% static 'restaurants/images/default-profile.png' %}" alt="Profile Picture" class="profile-pic">
            </a>
            </div>

        </div>

        <div id="map" class="map"></div>
    </div>
<script>
    let map;
let service;
let favorites = []; // Array to store favorite restaurants

function initMap() {
    const atlanta = { lat: 33.749, lng: -84.388 };

    // Initialize the map centered on Atlanta
    map = new google.maps.Map(document.getElementById('map'), {
        center: atlanta,
        zoom: 12
    });

    // Request object for the Google Places API
    const request = {
        location: atlanta,
        radius: '5000', // 5 km radius
        type: ['restaurant'] // Search for restaurants
    };

    // Initialize the Places service
    service = new google.maps.places.PlacesService(map);

    // Perform nearby search to get restaurants
    service.nearbySearch(request, handleSearchResults);
}

function getCuisineType(place) {
const cuisineMap = {
'chinese': 'Chinese',
'italian': 'Italian',
'japanese': 'Japanese',
'mexican': 'Mexican',
'thai': 'Thai',
'indian': 'Indian',
'korean': 'Korean',
'vietnamese': 'Vietnamese',
'greek': 'Greek',
'french': 'French',
'spanish': 'Spanish',
'american': 'American',
// Add more mappings as needed
};

// Extract types that indicate cuisine
const cuisines = place.types
.map(type => cuisineMap[type.toLowerCase()] || null)
.filter(cuisine => cuisine !== null);

// If no specific cuisine types are found, return 'Cuisine: Not Specified'
return cuisines.length > 0 ? cuisines.join(', ') : 'Cuisine: Not Specified';
}


function handleSearchResults(results, status) {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
        const restaurantList = document.getElementById('restaurant-list');
        restaurantList.innerHTML = ''; // Clear previous results

        // Loop through each result (restaurant)
        results.forEach((place) => {
            // Add marker for each restaurant on the map
            const marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location,
                title: place.name
            });

            // Create the restaurant item HTML
            const restaurantItem = document.createElement('div');
            restaurantItem.className = 'restaurant-item';
            restaurantItem.innerHTML = `
                <div class="icon favorite" data-id="${place.place_id}">☆</div>
                <div class="restaurant-info">
                    <p>Cuisine: ${getCuisineType(place)}</p>
                    <h3>${place.name}</h3>
                    <a href="#">See Details</a>
                </div>
            `;


            // Add event listener to center the map on restaurant when clicked
            restaurantItem.addEventListener('click', () => {
                map.panTo(place.geometry.location);
                map.setZoom(17);
            });

            // Add event listener to toggle favorite status
            restaurantItem.querySelector('.favorite').addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent triggering the restaurant click event
                const placeId = this.getAttribute('data-id');

                // Toggle favorite status
                if (favorites.includes(placeId)) {
                    favorites = favorites.filter(id => id !== placeId);
                    this.textContent = '☆'; // Change to hollow star
                } else {
                    favorites.push(placeId);
                    this.textContent = '★'; // Change to filled star
                }

                console.log('Favorites:', favorites); // Debug: log favorites
            });

            // Append the restaurant item to the list
            restaurantList.appendChild(restaurantItem);
        });
    }
}
</script>
</body>
</html>
